{"version":3,"sources":["../src/preload.ts"],"sourcesContent":["/**\n * @fileOverview Electron preload script.\n * This script runs in a privileged environment before the renderer process is loaded.\n * It uses `contextBridge` to securely expose specific APIs from the main process\n * to the renderer process.\n */\n\nimport { contextBridge, ipcRenderer, IpcRendererEvent } from 'electron';\nimport type { IPCChannel, IPCMessagePayload } from './ipc'; // Assuming IPC types are defined\n\n// Whitelisted channels for IPC communication\nconst validSendChannels: IPCChannel[] = ['example-request-data', 'open-external-link'];\nconst validReceiveChannels: IPCChannel[] = ['example-data-response', 'main-process-message'];\n\ncontextBridge.exposeInMainWorld('electronAPI', {\n  // Send messages from renderer to main\n  send: (channel: IPCChannel, data: IPCMessagePayload) => {\n    if (validSendChannels.includes(channel)) {\n      ipcRenderer.send(channel, data);\n    } else {\n      console.warn(`Blocked attempt to send to invalid IPC channel: ${channel}`);\n    }\n  },\n  // Receive messages from main to renderer (one-way)\n  on: (channel: IPCChannel, func: (...args: any[]) => void) => {\n    if (validReceiveChannels.includes(channel)) {\n      // Deliberately strip event as it includes `sender`\n      const subscription = (_event: IpcRendererEvent, ...args: any[]) => func(...args);\n      ipcRenderer.on(channel, subscription);\n      // Return a cleanup function\n      return () => {\n        ipcRenderer.removeListener(channel, subscription);\n      };\n    } else {\n      console.warn(`Blocked attempt to listen on invalid IPC channel: ${channel}`);\n      return () => {}; // Return a no-op cleanup function\n    }\n  },\n  // Invoke messages (renderer to main and back with a response)\n  invoke: async (channel: IPCChannel, data: IPCMessagePayload): Promise<any> => {\n    if (validSendChannels.includes(channel)) { // Often invoke uses same send channels\n      return ipcRenderer.invoke(channel, data);\n    } else {\n      console.warn(`Blocked attempt to invoke invalid IPC channel: ${channel}`);\n      return Promise.reject(new Error(`Invalid IPC channel: ${channel}`));\n    }\n  },\n  // Example: Expose a specific utility\n  getAppVersion: () => ipcRenderer.invoke('get-app-version'),\n\n  // Example: Expose a function to open external links safely\n  openExternal: (url: string) => {\n    // Basic validation, more robust validation might be needed\n    if (url && (url.startsWith('http:') || url.startsWith('https:') || url.startsWith('mailto:'))) {\n      ipcRenderer.send('open-external-link', url);\n    } else {\n      console.warn(`Blocked attempt to open invalid external URL: ${url}`);\n    }\n  }\n});\n\n// Optional: Log that preload script has loaded\nconsole.log('Electron Preload Script Loaded.');\n\n// It's good practice to clean up listeners when the window is unloaded,\n// though ipcRenderer listeners are often managed per-component in React/Vue.\n// window.addEventListener('unload', () => {\n//   // ipcRenderer.removeAllListeners(); // Use with caution, might remove other listeners\n// });\n"],"mappings":";;;;;;;AAOA,SAAS,eAAe,mBAAqC;AAP7D;AAAA;AAWA,QAAM,oBAAkC,CAAC,wBAAwB,oBAAoB;AACrF,QAAM,uBAAqC,CAAC,yBAAyB,sBAAsB;AAE3F,kBAAc,kBAAkB,eAAe;AAAA;AAAA,MAE7C,MAAM,CAAC,SAAqB,SAA4B;AACtD,YAAI,kBAAkB,SAAS,OAAO,GAAG;AACvC,sBAAY,KAAK,SAAS,IAAI;AAAA,QAChC,OAAO;AACL,kBAAQ,KAAK,mDAAmD,OAAO,EAAE;AAAA,QAC3E;AAAA,MACF;AAAA;AAAA,MAEA,IAAI,CAAC,SAAqB,SAAmC;AAC3D,YAAI,qBAAqB,SAAS,OAAO,GAAG;AAE1C,gBAAM,eAAe,CAAC,WAA6B,SAAgB,KAAK,GAAG,IAAI;AAC/E,sBAAY,GAAG,SAAS,YAAY;AAEpC,iBAAO,MAAM;AACX,wBAAY,eAAe,SAAS,YAAY;AAAA,UAClD;AAAA,QACF,OAAO;AACL,kBAAQ,KAAK,qDAAqD,OAAO,EAAE;AAC3E,iBAAO,MAAM;AAAA,UAAC;AAAA,QAChB;AAAA,MACF;AAAA;AAAA,MAEA,QAAQ,OAAO,SAAqB,SAA0C;AAC5E,YAAI,kBAAkB,SAAS,OAAO,GAAG;AACvC,iBAAO,YAAY,OAAO,SAAS,IAAI;AAAA,QACzC,OAAO;AACL,kBAAQ,KAAK,kDAAkD,OAAO,EAAE;AACxE,iBAAO,QAAQ,OAAO,IAAI,MAAM,wBAAwB,OAAO,EAAE,CAAC;AAAA,QACpE;AAAA,MACF;AAAA;AAAA,MAEA,eAAe,MAAM,YAAY,OAAO,iBAAiB;AAAA;AAAA,MAGzD,cAAc,CAAC,QAAgB;AAE7B,YAAI,QAAQ,IAAI,WAAW,OAAO,KAAK,IAAI,WAAW,QAAQ,KAAK,IAAI,WAAW,SAAS,IAAI;AAC7F,sBAAY,KAAK,sBAAsB,GAAG;AAAA,QAC5C,OAAO;AACL,kBAAQ,KAAK,iDAAiD,GAAG,EAAE;AAAA,QACrE;AAAA,MACF;AAAA,IACF,CAAC;AAGD,YAAQ,IAAI,iCAAiC;AAAA;AAAA;","names":[]}